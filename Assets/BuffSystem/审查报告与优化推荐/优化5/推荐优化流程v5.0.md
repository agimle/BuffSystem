# BuffSystem æ¨èä¼˜åŒ–æµç¨‹ v5.0

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v5.0  
**æ›´æ–°æ—¥æœŸï¼š** 2026-02-12  
**é€‚ç”¨èŒƒå›´ï¼š** BuffSystem v5.x ç‰ˆæœ¬ä¼˜åŒ–  
**å‰ç½®æ¡ä»¶ï¼š** å·²å®Œæˆv1.0-v4.0æ‰€æœ‰ä¼˜åŒ–é¡¹

---

## ç›®å½•

1. [ä¼˜åŒ–æ€»è§ˆ](#ä¼˜åŒ–æ€»è§ˆ)
2. [Phase 1: æ ¸å¿ƒåŠŸèƒ½å®Œå–„](#phase-1-æ ¸å¿ƒåŠŸèƒ½å®Œå–„)
3. [Phase 2: å¼€å‘è€…ä½“éªŒ](#phase-2-å¼€å‘è€…ä½“éªŒ)
4. [Phase 3: é«˜çº§ç‰¹æ€§](#phase-3-é«˜çº§ç‰¹æ€§)
5. [ä¼˜åŒ–å®æ–½æ£€æŸ¥æ¸…å•](#ä¼˜åŒ–å®æ–½æ£€æŸ¥æ¸…å•)
6. [ç‰ˆæœ¬å‘å¸ƒè®¡åˆ’](#ç‰ˆæœ¬å‘å¸ƒè®¡åˆ’)

---

## ä¼˜åŒ–æ€»è§ˆ

### v5.0ä¼˜åŒ–ç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BuffSystem v5.0 ä¼˜åŒ–ç›®æ ‡                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›®æ ‡ï¼šè¾¾åˆ°100%ç”Ÿäº§å°±ç»ªåº¦ï¼Œæ‰“é€ è¡Œä¸šæ ‡æ†çº§Buffç³»ç»Ÿæ¡†æ¶       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŠŸèƒ½ç›®æ ‡ï¼š100%åŠŸèƒ½è¦†ç›–ï¼Œ15+å†…ç½®Effectï¼Œå®Œæ•´ç¤ºä¾‹é¡¹ç›®        â”‚
â”‚  ä½“éªŒç›®æ ‡ï¼š15åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ï¼Œå¯è§†åŒ–è°ƒè¯•ï¼Œå®Œå–„æ–‡æ¡£             â”‚
â”‚  æ‰©å±•ç›®æ ‡ï¼šç½‘ç»œåŒæ­¥æ”¯æŒï¼Œå¤šæ¡†æ¶å…¼å®¹                         â”‚
â”‚  è´¨é‡ç›®æ ‡ï¼š95%+å•å…ƒæµ‹è¯•è¦†ç›–ï¼Œé›¶å´©æºƒï¼Œå‘åå…¼å®¹               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### v4.0 â†’ v5.0æ¼”è¿›

| ä¼˜åŒ–é¡¹ | v4.0çŠ¶æ€ | v5.0çŠ¶æ€ | è¯´æ˜ |
|--------|---------|---------|------|
| å†…ç½®Effectåº“ | âœ… å·²å®Œæˆ | âœ… å·²å®Œæˆ | 5ä¸ªCore Effectå·²å®ç° |
| å­˜æ¡£ç‰ˆæœ¬ç®¡ç† | âœ… å·²å®Œæˆ | âœ… å·²å®Œæˆ | BuffSaveManagerå·²å®ç° |
| å®Œæ•´ç¤ºä¾‹é¡¹ç›® | â¬œ å¾…å®Œæˆ | ğŸ”µ ä¿ç•™ | çº³å…¥Phase 2 |
| å¯è§†åŒ–è°ƒè¯•çª—å£ | â¬œ å¾…å®Œæˆ | ğŸ”µ ä¿ç•™ | çº³å…¥Phase 2 |
| æ€§èƒ½ç›‘æ§å™¨ | â¬œ å¾…å®Œæˆ | ğŸ”µ ä¿ç•™ | çº³å…¥Phase 2 |
| æ–‡æ¡£å®Œå–„ | âœ… å·²å®Œæˆ | âœ… å·²å®Œæˆ | åŸºç¡€æ–‡æ¡£å·²å®Œå–„ |
| ç½‘ç»œåŒæ­¥æ”¯æŒ | âœ… å·²å®Œæˆ | âœ… å·²å®Œæˆ | Mirror/Netcodeæ”¯æŒå·²å®ç° |

### ä¼˜åŒ–è·¯çº¿å›¾

```
æ—¶é—´çº¿ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

Phase 1 (1-2å‘¨)      Phase 2 (1-2å‘¨)      Phase 3 (1-2å‘¨)
   æ ¸å¿ƒåŠŸèƒ½å®Œå–„          å¼€å‘è€…ä½“éªŒ            é«˜çº§ç‰¹æ€§
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚å†…ç½®Effectâ”‚   â†’    â”‚ç¤ºä¾‹é¡¹ç›® â”‚   â†’    â”‚ç½‘ç»œåŒæ­¥ â”‚
   â”‚å­˜æ¡£ç‰ˆæœ¬ â”‚        â”‚è°ƒè¯•çª—å£ â”‚        â”‚æœ€ç»ˆä¼˜åŒ– â”‚
   â”‚ç›‘æ§å™¨  â”‚        â”‚æ–‡æ¡£å®Œå–„ â”‚        â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: æ ¸å¿ƒåŠŸèƒ½å®Œå–„

### ğŸ”µ 1.1 å†…ç½®Effectåº“ - é›¶è€¦åˆè®¾è®¡

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜  
**é¢„ä¼°å·¥æ—¶ï¼š** 2-3å¤©  
**å½±å“èŒƒå›´ï¼š** æ–°å¢`Effects/Core`æ–‡ä»¶å¤¹  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆï¼ˆv5.0å·²å®ç°ï¼‰

#### è®¾è®¡åŸåˆ™

**âŒ ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜ï¼š**
æä¾›`ModifyAttributeEffect`ã€`DamageOverTimeEffect`ç­‰è€¦åˆæ•°å€¼ç³»ç»Ÿçš„Effectï¼Œä¼šï¼š
- å‡è®¾ç”¨æˆ·æœ‰å±æ€§ç³»ç»Ÿï¼ˆ`IAttributeOwner`ï¼‰
- å‡è®¾ç”¨æˆ·æœ‰ä¼¤å®³æ¥å£ï¼ˆ`IDamageable`ï¼‰
- å‡è®¾ç”¨æˆ·çš„æ•°å€¼è®¡ç®—æ–¹å¼

**âœ… é›¶è€¦åˆæ–¹æ¡ˆï¼š**
åªæä¾›çº¯è¡Œä¸º/è¡¨ç°Effectï¼Œé€šè¿‡**äº‹ä»¶æœºåˆ¶**è§£è€¦æ‰€æœ‰æ•°å€¼é€»è¾‘ã€‚

#### å®ç°æ–¹æ¡ˆ

```csharp
// =====================================================
// 5ä¸ªCore Effect - 100%é€šç”¨ï¼Œé›¶è€¦åˆ
// =====================================================

// Effects/Core/SpawnEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.Core
{
    /// <summary>
    /// ç”Ÿæˆé¢„åˆ¶ä½“Effect - å®Œå…¨é€šç”¨
    /// </summary>
    [Serializable]
    public class SpawnEffect : EffectBase
    {
        [Tooltip("é¢„åˆ¶ä½“")]
        [SerializeField] private GameObject prefab;
        
        [Tooltip("ç”Ÿæˆä½ç½®åç§»")]
        [SerializeField] private Vector3 offset;
        
        [Tooltip("æ˜¯å¦é™„åŠ åˆ°æŒæœ‰è€…")]
        [SerializeField] private bool attachToOwner = true;
        
        [Tooltip("è‡ªåŠ¨é”€æ¯æ—¶é—´ï¼ˆç§’ï¼Œ-1è¡¨ç¤ºä¸é”€æ¯ï¼‰")]
        [SerializeField] private float destroyAfter = -1f;
        
        private GameObject spawnedInstance;
        
        public override void Execute(IBuff buff)
        {
            if (prefab == null) return;
            
            Vector3 spawnPosition = buff.Owner is MonoBehaviour mono 
                ? mono.transform.position + offset 
                : offset;
            
            spawnedInstance = UnityEngine.Object.Instantiate(prefab, spawnPosition, Quaternion.identity);
            
            if (attachToOwner && buff.Owner is MonoBehaviour ownerMono)
            {
                spawnedInstance.transform.SetParent(ownerMono.transform);
            }
            
            if (destroyAfter > 0)
            {
                UnityEngine.Object.Destroy(spawnedInstance, destroyAfter);
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            if (spawnedInstance != null && destroyAfter <= 0)
            {
                UnityEngine.Object.Destroy(spawnedInstance);
            }
        }
    }
}

// Effects/Core/PlayAnimationEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.Core
{
    /// <summary>
    /// æ’­æ”¾åŠ¨ç”»Effect - å®Œå…¨é€šç”¨
    /// </summary>
    [Serializable]
    public class PlayAnimationEffect : EffectBase
    {
        [Tooltip("åŠ¨ç”»çŠ¶æ€å")]
        [SerializeField] private string animationName;
        
        [Tooltip("åŠ¨ç”»å±‚")]
        [SerializeField] private int layer = 0;
        
        [Tooltip("æ·¡å…¥æ—¶é—´")]
        [SerializeField] private float crossFadeTime = 0.1f;
        
        public override void Execute(IBuff buff)
        {
            if (buff.Owner is not MonoBehaviour mono) return;
            
            var animator = mono.GetComponent<Animator>();
            if (animator != null && !string.IsNullOrEmpty(animationName))
            {
                animator.CrossFade(animationName, crossFadeTime, layer);
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            // å¯é€‰ï¼šæ¢å¤é»˜è®¤åŠ¨ç”»
        }
    }
}

// Effects/Core/PlaySoundEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.Core
{
    /// <summary>
    /// æ’­æ”¾éŸ³æ•ˆEffect - å®Œå…¨é€šç”¨
    /// </summary>
    [Serializable]
    public class PlaySoundEffect : EffectBase
    {
        [Tooltip("éŸ³æ•ˆå‰ªè¾‘")]
        [SerializeField] private AudioClip clip;
        
        [Tooltip("éŸ³é‡")]
        [SerializeField] private float volume = 1f;
        
        [Tooltip("æ˜¯å¦å¾ªç¯")]
        [SerializeField] private bool loop = false;
        
        private AudioSource audioSource;
        
        public override void Execute(IBuff buff)
        {
            if (clip == null) return;
            
            if (buff.Owner is MonoBehaviour mono)
            {
                audioSource = mono.gameObject.AddComponent<AudioSource>();
                audioSource.clip = clip;
                audioSource.volume = volume;
                audioSource.loop = loop;
                audioSource.Play();
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            if (audioSource != null)
            {
                if (loop)
                {
                    audioSource.Stop();
                }
                UnityEngine.Object.Destroy(audioSource);
            }
        }
    }
}

// Effects/Core/TriggerEventEffect.cs - æ ¸å¿ƒè§£è€¦æœºåˆ¶
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.Core
{
    /// <summary>
    /// è§¦å‘äº‹ä»¶Effect - æ ¸å¿ƒè§£è€¦æœºåˆ¶
    /// åªè§¦å‘äº‹ä»¶ï¼Œä¸æ‰§è¡Œä»»ä½•æ•°å€¼é€»è¾‘
    /// </summary>
    [Serializable]
    public class TriggerEventEffect : EffectBase
    {
        [Tooltip("äº‹ä»¶åç§°")]
        [SerializeField] private string eventName = "BuffEvent";
        
        [Tooltip("å­—ç¬¦ä¸²å‚æ•°")]
        [SerializeField] private string stringParam;
        
        [Tooltip("æ•°å€¼å‚æ•°")]
        [SerializeField] private float floatParam;
        
        [Tooltip("æ•´æ•°å‚æ•°")]
        [SerializeField] private int intParam;
        
        [Tooltip("å¸ƒå°”å‚æ•°")]
        [SerializeField] private bool boolParam;
        
        public override void Execute(IBuff buff)
        {
            var eventData = new BuffEventData
            {
                Buff = buff,
                EventName = eventName,
                StringParam = stringParam,
                FloatParam = floatParam,
                IntParam = intParam,
                BoolParam = boolParam
            };
            
            // è§¦å‘å…¨å±€äº‹ä»¶
            BuffEventSystem.Trigger($"Buff.{eventName}", eventData);
            
            // è§¦å‘æŒæœ‰è€…æœ¬åœ°äº‹ä»¶
            if (buff.Owner is IBuffEventReceiver receiver)
            {
                receiver.OnBuffEvent(buff, eventName, eventData);
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            var eventData = new BuffEventData
            {
                Buff = buff,
                EventName = $"{eventName}Cancelled"
            };
            
            BuffEventSystem.Trigger($"Buff.{eventName}Cancelled", eventData);
        }
    }
    
    /// <summary>
    /// Buffäº‹ä»¶æ•°æ®
    /// </summary>
    public class BuffEventData
    {
        public IBuff Buff { get; set; }
        public string EventName { get; set; }
        public string StringParam { get; set; }
        public float FloatParam { get; set; }
        public int IntParam { get; set; }
        public bool BoolParam { get; set; }
    }
}

// Effects/Core/DelayEffect.cs
using System;
using System.Collections.Generic;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.Core
{
    /// <summary>
    /// å»¶è¿Ÿæ‰§è¡ŒEffect - å»¶è¿Ÿä¸€æ®µæ—¶é—´åæ‰§è¡Œå…¶ä»–Effect
    /// </summary>
    [Serializable]
    public class DelayEffect : EffectBase, IBuffLogicUpdate
    {
        [Tooltip("å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰")]
        [SerializeField] private float delay = 1f;
        
        [Tooltip("å»¶è¿Ÿåæ‰§è¡Œçš„Effect")]
        [SerializeReference, SubclassSelector]
        private List<IEffect> delayedEffects = new();
        
        private float timer;
        private bool hasTriggered;
        
        public override void Execute(IBuff buff)
        {
            timer = 0f;
            hasTriggered = false;
        }
        
        public void OnLogicUpdate(float deltaTime)
        {
            if (hasTriggered) return;
            
            timer += deltaTime;
            
            if (timer >= delay)
            {
                hasTriggered = true;
                
                foreach (var effect in delayedEffects)
                {
                    effect?.Execute(Buff);
                }
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            foreach (var effect in delayedEffects)
            {
                effect?.Cancel(buff);
            }
        }
    }
}

// =====================================================
// æ¸¸æˆç«¯ä½¿ç”¨ç¤ºä¾‹ - å®Œå…¨è§£è€¦
// =====================================================

// æ¸¸æˆè‡ªå·±çš„Buffå¤„ç†å™¨
public class MyGameBuffHandler : MonoBehaviour
{
    void OnEnable()
    {
        // ç›‘å¬Buffäº‹ä»¶ï¼Œå®ç°å…·ä½“çš„æ•°å€¼é€»è¾‘
        BuffEventSystem.On<BuffEventData>("Buff.ModifyAttack", OnModifyAttack);
        BuffEventSystem.On<BuffEventData>("Buff.DealDamage", OnDealDamage);
        BuffEventSystem.On<BuffEventData>("Buff.ApplyPoison", OnApplyPoison);
    }
    
    void OnModifyAttack(BuffEventData data)
    {
        // ä½¿ç”¨æ¸¸æˆè‡ªå·±çš„æ•°å€¼ç³»ç»Ÿ
        if (data.Buff.Owner is MyPlayer player)
        {
            int value = data.IntParam;
            player.Stats.Attack += value;
            Debug.Log($"æ”»å‡»å¢åŠ  {value}ï¼Œå½“å‰æ”»å‡»: {player.Stats.Attack}");
        }
    }
    
    void OnDealDamage(BuffEventData data)
    {
        if (data.Buff.Owner is MyPlayer player)
        {
            int damage = data.IntParam;
            // ä½¿ç”¨æ¸¸æˆè‡ªå·±çš„ä¼¤å®³è®¡ç®—
            player.DealDamage(damage, data.Buff.Source);
        }
    }
    
    void OnApplyPoison(BuffEventData data)
    {
        // å®ç°æ¯’æ•ˆæœé€»è¾‘
    }
}

// åœ¨Buff Dataä¸­é…ç½®
// ä½¿ç”¨ TriggerEventEffect + eventName: "ModifyAttack", intParam: 10
// å³å¯å®ç°æ”»å‡»+10çš„æ•ˆæœï¼Œä½†å®Œå…¨ä¸è€¦åˆæ•°å€¼ç³»ç»Ÿ
        
        [Tooltip("ä¼¤å®³ç±»å‹")]
        [SerializeField] private DamageType damageType = DamageType.Magic;
        
        [Tooltip("æ˜¯å¦æ— è§†é˜²å¾¡")]
        [SerializeField] private bool ignoreDefense = false;
        
        [Tooltip("æ˜¯å¦éšå±‚æ•°ç¼©æ”¾")]
        [SerializeField] private bool scaleWithStack = true;
        
        // ç´¯ç§¯ä¼¤å®³ï¼ˆç”¨äºæ•´æ•°åŒ–ï¼‰
        private float damageAccumulator;
        
        public void OnLogicUpdate(float deltaTime)
        {
            // è®¡ç®—æœ¬æ¬¡ä¼¤å®³
            float damage = damagePerSecond * deltaTime;
            if (scaleWithStack)
            {
                damage *= Buff.CurrentStack;
            }
            
            damageAccumulator += damage;
            
            // å½“ç´¯ç§¯ä¼¤å®³ >= 1æ—¶æ‰§è¡Œ
            if (damageAccumulator >= 1f)
            {
                int actualDamage = Mathf.FloorToInt(damageAccumulator);
                damageAccumulator -= actualDamage;
                
                // é€ æˆä¼¤å®³
                if (Owner is IDamageable damageable)
                {
                    var damageInfo = new DamageInfo(
                        actualDamage, 
                        damageType, 
                        Source, 
                        ignoreDefense
                    );
                    damageable.TakeDamage(damageInfo);
                }
            }
        }
    }
    
    public enum DamageType
    {
        Physical,
        Magic,
        True
    }
    
    public interface IDamageable
    {
        void TakeDamage(DamageInfo damageInfo);
    }
    
    public struct DamageInfo
    {
        public int Amount;
        public DamageType Type;
        public object Source;
        public bool IgnoreDefense;
        
        public DamageInfo(int amount, DamageType type, object source, bool ignoreDefense)
        {
            Amount = amount;
            Type = type;
            Source = source;
            IgnoreDefense = ignoreDefense;
        }
    }
}

// Effects/BuiltIn/Combat/HealOverTimeEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.BuiltIn
{
    /// <summary>
    /// æŒç»­æ²»ç–—Effect - æ¯ç§’æ¢å¤ç”Ÿå‘½å€¼
    /// </summary>
    [Serializable]
    public class HealOverTimeEffect : EffectBase, IBuffLogicUpdate
    {
        [Tooltip("æ¯ç§’æ²»ç–—é‡")]
        [SerializeField] private float healPerSecond = 5f;
        
        [Tooltip("æ˜¯å¦ä¸ºç™¾åˆ†æ¯”æ²»ç–—")]
        [SerializeField] private bool isPercent;
        
        [Tooltip("ç™¾åˆ†æ¯”åŸºæ•°ï¼ˆæœ€å¤§ç”Ÿå‘½å€¼æ¯”ä¾‹ï¼‰")]
        [SerializeField] private float percentOfMaxHealth = 0.02f;
        
        [Tooltip("æ˜¯å¦éšå±‚æ•°ç¼©æ”¾")]
        [SerializeField] private bool scaleWithStack = true;
        
        private float healAccumulator;
        
        public void OnLogicUpdate(float deltaTime)
        {
            float heal = healPerSecond * deltaTime;
            
            // ç™¾åˆ†æ¯”æ²»ç–—
            if (isPercent && Owner is IHealthOwner healthOwner)
            {
                heal += healthOwner.MaxHealth * percentOfMaxHealth * deltaTime;
            }
            
            // å±‚æ•°ç¼©æ”¾
            if (scaleWithStack)
            {
                heal *= Buff.CurrentStack;
            }
            
            healAccumulator += heal;
            
            // æ‰§è¡Œæ²»ç–—
            if (healAccumulator >= 1f)
            {
                int actualHeal = Mathf.FloorToInt(healAccumulator);
                healAccumulator -= actualHeal;
                
                if (Owner is IHealable healable)
                {
                    healable.Heal(actualHeal, Source);
                }
            }
        }
    }
    
    public interface IHealthOwner
    {
        float MaxHealth { get; }
        float CurrentHealth { get; }
    }
    
    public interface IHealable
    {
        void Heal(int amount, object source);
    }
}

// Effects/BuiltIn/Combat/ShieldEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.BuiltIn
{
    /// <summary>
    /// æŠ¤ç›¾Effect - å¸æ”¶ä¸€å®šé‡ä¼¤å®³
    /// </summary>
    [Serializable]
    public class ShieldEffect : EffectBase, IBuffStackChange
    {
        [Tooltip("æ¯å±‚æŠ¤ç›¾å€¼")]
        [SerializeField] private float shieldPerStack = 50f;
        
        [Tooltip("æŠ¤ç›¾æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰")]
        [SerializeField] private float shieldDuration = 5f;
        
        private float currentShield;
        
        public override void Execute(IBuff buff)
        {
            currentShield = shieldPerStack * buff.CurrentStack;
            
            if (Owner is IShieldable shieldable)
            {
                shieldable.AddShield(currentShield, shieldDuration);
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            if (Owner is IShieldable shieldable)
            {
                shieldable.RemoveShield(currentShield);
            }
        }
        
        public void OnStackChanged(int oldStack, int newStack)
        {
            float oldShield = shieldPerStack * oldStack;
            float newShield = shieldPerStack * newStack;
            
            if (Owner is IShieldable shieldable)
            {
                shieldable.RemoveShield(oldShield);
                shieldable.AddShield(newShield, shieldDuration);
            }
            
            currentShield = newShield;
        }
    }
    
    public interface IShieldable
    {
        void AddShield(float amount, float duration);
        void RemoveShield(float amount);
    }
}

// Effects/BuiltIn/Control/StunEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.BuiltIn
{
    /// <summary>
    /// çœ©æ™•Effect - ç¦æ­¢ç§»åŠ¨å’Œæ”»å‡»
    /// </summary>
    [Serializable]
    public class StunEffect : EffectBase
    {
        [Tooltip("çœ©æ™•ç‰¹æ•ˆé¢„åˆ¶ä½“")]
        [SerializeField] private GameObject stunVfxPrefab;
        
        private GameObject spawnedVfx;
        
        public override void Execute(IBuff buff)
        {
            if (Owner is IStunnable stunnable)
            {
                stunnable.SetStunned(true);
            }
            
            // ç”Ÿæˆç‰¹æ•ˆ
            if (stunVfxPrefab != null && Owner is MonoBehaviour mono)
            {
                spawnedVfx = Object.Instantiate(stunVfxPrefab, mono.transform);
            }
        }
        
        public override void Cancel(IBuff buff)
        {
            if (Owner is IStunnable stunnable)
            {
                stunnable.SetStunned(false);
            }
            
            // é”€æ¯ç‰¹æ•ˆ
            if (spawnedVfx != null)
            {
                Object.Destroy(spawnedVfx);
            }
        }
    }
    
    public interface IStunnable
    {
        void SetStunned(bool isStunned);
    }
}

// Effects/BuiltIn/Utility/PeriodicTriggerEffect.cs
using System;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Effects.BuiltIn
{
    /// <summary>
    /// å‘¨æœŸæ€§è§¦å‘Effect - æŒ‰å›ºå®šé—´éš”è§¦å‘äº‹ä»¶
    /// </summary>
    [Serializable]
    public class PeriodicTriggerEffect : EffectBase, IBuffLogicUpdate
    {
        [Tooltip("è§¦å‘é—´éš”ï¼ˆç§’ï¼‰")]
        [SerializeField] private float interval = 1f;
        
        [Tooltip("è§¦å‘äº‹ä»¶åç§°")]
        [SerializeField] private string triggerEvent = "PeriodicTrigger";
        
        [Tooltip("æ˜¯å¦åœ¨æ·»åŠ æ—¶ç«‹å³è§¦å‘ä¸€æ¬¡")]
        [SerializeField] private bool triggerOnAdd = false;
        
        private float timer;
        private int triggerCount;
        
        public override void Execute(IBuff buff)
        {
            timer = 0f;
            triggerCount = 0;
            
            if (triggerOnAdd)
            {
                Trigger(buff);
            }
        }
        
        public void OnLogicUpdate(float deltaTime)
        {
            timer += deltaTime;
            
            if (timer >= interval)
            {
                timer -= interval;
                Trigger(Buff);
            }
        }
        
        private void Trigger(IBuff buff)
        {
            triggerCount++;
            
            var eventData = new PeriodicTriggerData
            {
                TriggerCount = triggerCount,
                Stack = buff.CurrentStack,
                Interval = interval
            };
            
            SendEvent(buff, triggerEvent, eventData);
        }
    }
    
    public struct PeriodicTriggerData
    {
        public int TriggerCount;
        public int Stack;
        public float Interval;
    }
}
```

#### 5ä¸ªCore Effectæ¸…å•ï¼ˆ100%é€šç”¨ï¼‰

| Effectåç§° | åŠŸèƒ½ | è€¦åˆåº¦ | è¯´æ˜ |
|-----------|------|--------|------|
| **SpawnEffect** | ç”Ÿæˆé¢„åˆ¶ä½“ | 0% | çº¯è¡¨ç°ï¼Œå®Œå…¨é€šç”¨ |
| **PlayAnimationEffect** | æ’­æ”¾åŠ¨ç”» | 0% | çº¯è¡¨ç°ï¼Œå®Œå…¨é€šç”¨ |
| **PlaySoundEffect** | æ’­æ”¾éŸ³æ•ˆ | 0% | çº¯è¡¨ç°ï¼Œå®Œå…¨é€šç”¨ |
| **TriggerEventEffect** | è§¦å‘äº‹ä»¶ | 0% | **æ ¸å¿ƒè§£è€¦æœºåˆ¶** |
| **DelayEffect** | å»¶è¿Ÿæ‰§è¡Œ | 0% | ç»„åˆå…¶ä»–Effect |

#### ä¸ºä»€ä¹ˆåªæœ‰5ä¸ªï¼Ÿ

**âŒ ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜ï¼š**
æä¾›15ä¸ªè€¦åˆæ•°å€¼ç³»ç»Ÿçš„Effectï¼Œæ¯ä¸ªéƒ½ä¼šï¼š
- å‡è®¾ç”¨æˆ·æœ‰æŸç§æ¥å£ï¼ˆ`IAttributeOwner`ã€`IDamageable`ç­‰ï¼‰
- å‡è®¾ç”¨æˆ·çš„æ•°å€¼è®¡ç®—æ–¹å¼
- å¯¼è‡´80%çš„Effectå¯¹ç‰¹å®šæ¸¸æˆæ— ç”¨

**âœ… é›¶è€¦åˆæ–¹æ¡ˆçš„ä¼˜åŠ¿ï¼š**
- 5ä¸ªEffect 100%å¯ç”¨ï¼Œé›¶å­¦ä¹ æˆæœ¬
- `TriggerEventEffect`é€šè¿‡äº‹ä»¶æœºåˆ¶ï¼Œå¯ä»¥å®ç°**ä»»æ„**æ•°å€¼æ•ˆæœ
- ç”¨æˆ·æ ¹æ®è‡ªå·±æ¸¸æˆçš„æ•°å€¼ç³»ç»Ÿå†™é€»è¾‘ï¼Œæ›´çµæ´»

#### å¦‚ä½•ä½¿ç”¨TriggerEventEffectå®ç°ä»»æ„æ•ˆæœ

```csharp
// 1. åœ¨Buff Dataä¸­é…ç½®
// Effect: TriggerEventEffect
// eventName: "ModifyAttack"
// intParam: 10

// 2. åœ¨æ¸¸æˆä»£ç ä¸­ç›‘å¬äº‹ä»¶
public class MyGameBuffHandler : MonoBehaviour
{
    void OnEnable()
    {
        BuffEventSystem.On<BuffEventData>("Buff.ModifyAttack", OnModifyAttack);
        BuffEventSystem.On<BuffEventData>("Buff.DealDamage", OnDealDamage);
        BuffEventSystem.On<BuffEventData>("Buff.ApplyPoison", OnApplyPoison);
        // ... ä»»æ„æ•°é‡çš„äº‹ä»¶
    }
    
    void OnModifyAttack(BuffEventData data)
    {
        // ä½¿ç”¨æ¸¸æˆè‡ªå·±çš„æ•°å€¼ç³»ç»Ÿå®ç°
        var player = data.Buff.Owner as MyPlayer;
        player.Stats.Attack += data.IntParam;
    }
}
```

#### é…å¥—æ–‡æ¡£ï¼ˆæ›¿ä»£æ¨¡æ¿ï¼‰

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| **Effect-Development-Guide.md** | å¦‚ä½•ç¼–å†™è‡ªå·±çš„Effect |
| **Common-Patterns.md** | å¸¸è§Effectæ¨¡å¼ç¤ºä¾‹ï¼ˆDOTã€HOTã€æŠ¤ç›¾ç­‰ï¼‰ |
| **Best-Practices.md** | Effectå¼€å‘æœ€ä½³å®è·µ |

#### éªŒæ”¶æ ‡å‡†

- [ ] 5ä¸ªCore Effectå®ç°ï¼ˆ100%é€šç”¨ï¼‰
- [ ] TriggerEventEffectæ”¯æŒå¤šç§å‚æ•°ç±»å‹
- [ ] æ¯ä¸ªEffectæœ‰è¯¦ç»†æ³¨é‡Š
- [ ] æä¾›å®Œæ•´çš„äº‹ä»¶ä½¿ç”¨ç¤ºä¾‹
- [ ] é…å¥—3ç¯‡å¼€å‘æ–‡æ¡£
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>90%

---

### ğŸ”µ 1.2 å­˜æ¡£ç‰ˆæœ¬ç®¡ç†

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜  
**é¢„ä¼°å·¥æ—¶ï¼š** 2-3å¤©  
**å½±å“èŒƒå›´ï¼š** `BuffSaveManager`, `IBuffSerializable`  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆï¼ˆv5.0å·²å®ç°ï¼‰

#### è®¾è®¡ç›®æ ‡

æ”¯æŒå­˜æ¡£ç‰ˆæœ¬å…¼å®¹ï¼Œæ¸¸æˆå‡çº§åèƒ½å¤Ÿæ­£ç¡®è¯»å–æ—§ç‰ˆæœ¬å­˜æ¡£ã€‚

#### å®ç°æ–¹æ¡ˆ

```csharp
// Core/IBuffSerializable.cs æ‰©å±•
namespace BuffSystem.Core
{
    /// <summary>
    /// Buffå­˜æ¡£æ•°æ® - æ”¯æŒç‰ˆæœ¬ç®¡ç†
    /// </summary>
    public class BuffSaveData
    {
        /// <summary>
        /// å­˜æ¡£æ ¼å¼ç‰ˆæœ¬
        /// </summary>
        public int Version = CurrentVersion;
        
        public int BuffId;
        public int CurrentStack;
        public float ElapsedDuration;
        public int SourceId;
        public Dictionary<string, string> CustomData;
        
        /// <summary>
        /// å½“å‰ç³»ç»Ÿç‰ˆæœ¬
        /// </summary>
        public const int CurrentVersion = 2;
        
        public BuffSaveData()
        {
            CustomData = new Dictionary<string, string>();
        }
        
        /// <summary>
        /// è¿ç§»åˆ°æœ€æ–°ç‰ˆæœ¬
        /// </summary>
        public void MigrateToLatest()
        {
            while (Version < CurrentVersion)
            {
                MigrateFromVersion(Version);
                Version++;
            }
        }
        
        /// <summary>
        /// ä»æŒ‡å®šç‰ˆæœ¬è¿ç§»
        /// </summary>
        private void MigrateFromVersion(int fromVersion)
        {
            switch (fromVersion)
            {
                case 1:
                    MigrateV1ToV2();
                    break;
                    // æœªæ¥ç‰ˆæœ¬æ·»åŠ æ›´å¤šcase
            }
        }
        
        /// <summary>
        /// v1 -> v2 è¿ç§»
        /// ç¤ºä¾‹ï¼šé‡å‘½åå­—æ®µ
        /// </summary>
        private void MigrateV1ToV2()
        {
            // å­—æ®µé‡å‘½åç¤ºä¾‹
            if (CustomData.TryGetValue("oldFieldName", out var value))
            {
                CustomData["newFieldName"] = value;
                CustomData.Remove("oldFieldName");
            }
            
            // æ•°æ®è½¬æ¢ç¤ºä¾‹
            if (CustomData.TryGetValue("damageType", out var damageTypeStr))
            {
                // è½¬æ¢æ—§çš„ä¼¤å®³ç±»å‹æšä¸¾å€¼
                if (int.TryParse(damageTypeStr, out var oldValue))
                {
                    var newValue = ConvertDamageType(oldValue);
                    CustomData["damageType"] = newValue.ToString();
                }
            }
        }
        
        private int ConvertDamageType(int oldValue)
        {
            // v1: 0=Physical, 1=Magic
            // v2: 0=Physical, 1=Magic, 2=True
            return oldValue; // æœ¬ä¾‹ä¸­å€¼ç›¸åŒ
        }
    }
    
    /// <summary>
    /// BuffæŒæœ‰è€…å­˜æ¡£æ•°æ®
    /// </summary>
    public class BuffOwnerSaveData
    {
        /// <summary>
        /// ç³»ç»Ÿç‰ˆæœ¬å·
        /// </summary>
        public int SystemVersion = BuffSaveData.CurrentVersion;
        
        public int OwnerId;
        public List<BuffSaveData> Buffs;
        
        public BuffOwnerSaveData()
        {
            Buffs = new List<BuffSaveData>();
        }
        
        /// <summary>
        /// éªŒè¯å¹¶ä¿®å¤å­˜æ¡£æ•°æ®
        /// </summary>
        public bool Validate()
        {
            // æ£€æŸ¥ç³»ç»Ÿç‰ˆæœ¬å…¼å®¹æ€§
            if (SystemVersion > BuffSaveData.CurrentVersion)
            {
                Debug.LogError($"[BuffSaveData] å­˜æ¡£ç‰ˆæœ¬ {SystemVersion} é«˜äºå½“å‰ç³»ç»Ÿç‰ˆæœ¬ {BuffSaveData.CurrentVersion}");
                return false;
            }
            
            // è¿ç§»æ‰€æœ‰Buffæ•°æ®
            foreach (var buff in Buffs)
            {
                buff.MigrateToLatest();
            }
            
            return true;
        }
    }
}

// Runtime/BuffSaveManager.cs ä¿®æ”¹
using System.Collections.Generic;
using UnityEngine;
using BuffSystem.Core;

namespace BuffSystem.Runtime
{
    /// <summary>
    /// Buffå­˜æ¡£ç®¡ç†å™¨ - æ”¯æŒç‰ˆæœ¬ç®¡ç†
    /// </summary>
    public static class BuffSaveManager
    {
        #region Save
        
        /// <summary>
        /// ä¿å­˜æ‰€æœ‰BuffæŒæœ‰è€…çš„çŠ¶æ€
        /// </summary>
        public static List<BuffOwnerSaveData> SaveAll()
        {
            var result = new List<BuffOwnerSaveData>();
            
            foreach (var owner in BuffOwner.AllOwners)
            {
                if (owner != null)
                {
                    var ownerSaveData = SaveOwner(owner);
                    if (ownerSaveData.Buffs.Count > 0)
                    {
                        // è®¾ç½®å½“å‰ç³»ç»Ÿç‰ˆæœ¬
                        ownerSaveData.SystemVersion = BuffSaveData.CurrentVersion;
                        result.Add(ownerSaveData);
                    }
                }
            }
            
            if (BuffSystemConfig.Instance.EnableDebugLog)
            {
                Debug.Log($"[BuffSaveManager] ä¿å­˜äº† {result.Count} ä¸ªæŒæœ‰è€…çš„Buffæ•°æ® (ç‰ˆæœ¬: {BuffSaveData.CurrentVersion})");
            }
            
            return result;
        }
        
        /// <summary>
        /// ä¿å­˜å•ä¸ªæŒæœ‰è€…çš„BuffçŠ¶æ€
        /// </summary>
        public static BuffOwnerSaveData SaveOwner(IBuffOwner owner)
        {
            var saveData = new BuffOwnerSaveData { OwnerId = owner.OwnerId };
            
            if (owner.BuffContainer == null)
            {
                return saveData;
            }
            
            foreach (var buff in owner.BuffContainer.AllBuffs)
            {
                var buffSaveData = SaveBuff(buff);
                if (buffSaveData != null)
                {
                    saveData.Buffs.Add(buffSaveData);
                }
            }
            
            return saveData;
        }
        
        /// <summary>
        /// ä¿å­˜å•ä¸ªBuffçš„çŠ¶æ€
        /// </summary>
        public static BuffSaveData SaveBuff(IBuff buff)
        {
            if (buff?.Data == null)
            {
                return null;
            }
            
            var saveData = new BuffSaveData
            {
                BuffId = buff.DataId,
                CurrentStack = buff.CurrentStack,
                ElapsedDuration = buff.Duration,
                SourceId = buff.Source != null ? buff.Source.GetHashCode() : 0
            };
            
            // åºåˆ—åŒ–è‡ªå®šä¹‰æ•°æ®
            if (buff.Data.CreateLogic() is IBuffSerializable serializable)
            {
                serializable.Serialize(saveData);
            }
            
            return saveData;
        }
        
        #endregion
        
        #region Load
        
        /// <summary>
        /// åŠ è½½æ‰€æœ‰BuffæŒæœ‰è€…çš„çŠ¶æ€
        /// </summary>
        public static void LoadAll(List<BuffOwnerSaveData> saveDataList)
        {
            int successCount = 0;
            int failCount = 0;
            
            foreach (var ownerSaveData in saveDataList)
            {
                // éªŒè¯å­˜æ¡£ç‰ˆæœ¬
                if (!ownerSaveData.Validate())
                {
                    failCount++;
                    continue;
                }
                
                // æ‰¾åˆ°å¯¹åº”çš„Owner
                var owner = FindOwnerById(ownerSaveData.OwnerId);
                if (owner != null)
                {
                    LoadOwner(owner, ownerSaveData);
                    successCount++;
                }
                else
                {
                    Debug.LogWarning($"[BuffSaveManager] æœªæ‰¾åˆ°IDä¸º {ownerSaveData.OwnerId} çš„BuffæŒæœ‰è€…");
                    failCount++;
                }
            }
            
            if (BuffSystemConfig.Instance.EnableDebugLog)
            {
                Debug.Log($"[BuffSaveManager] åŠ è½½å®Œæˆ: æˆåŠŸ {successCount}, å¤±è´¥ {failCount}");
            }
        }
        
        /// <summary>
        /// åŠ è½½å•ä¸ªæŒæœ‰è€…çš„BuffçŠ¶æ€
        /// </summary>
        public static void LoadOwner(IBuffOwner owner, BuffOwnerSaveData saveData)
        {
            if (owner.BuffContainer == null)
            {
                Debug.LogError($"[BuffSaveManager] {owner.OwnerName} çš„BuffContainerä¸ºç©º");
                return;
            }
            
            // æ¸…ç©ºç°æœ‰Buff
            owner.BuffContainer.ClearAllBuffs();
            
            // åŠ è½½å­˜æ¡£Buff
            foreach (var buffSaveData in saveData.Buffs)
            {
                LoadBuff(owner, buffSaveData);
            }
        }
        
        /// <summary>
        /// åŠ è½½å•ä¸ªBuff
        /// </summary>
        private static void LoadBuff(IBuffOwner owner, BuffSaveData saveData)
        {
            var data = BuffDatabase.Instance.GetBuffData(saveData.BuffId);
            if (data == null)
            {
                Debug.LogWarning($"[BuffSaveManager] æœªæ‰¾åˆ°IDä¸º {saveData.BuffId} çš„Buffé…ç½®");
                return;
            }
            
            // åˆ›å»ºBuff
            var buff = owner.BuffContainer.AddBuff(data, null);
            if (buff is BuffEntity entity)
            {
                // æ¢å¤å±‚æ•°
                if (saveData.CurrentStack > 1)
                {
                    entity.AddStack(saveData.CurrentStack - 1);
                }
                
                // æ¢å¤æŒç»­æ—¶é—´
                entity.SetDuration(saveData.ElapsedDuration);
                
                // ååºåˆ—åŒ–è‡ªå®šä¹‰æ•°æ®
                if (data.CreateLogic() is IBuffSerializable serializable)
                {
                    serializable.Deserialize(saveData);
                }
            }
        }
        
        /// <summary>
        /// æ ¹æ®IDæŸ¥æ‰¾BuffæŒæœ‰è€…
        /// </summary>
        private static IBuffOwner FindOwnerById(int ownerId)
        {
            foreach (var owner in BuffOwner.AllOwners)
            {
                if (owner.OwnerId == ownerId)
                {
                    return owner;
                }
            }
            return null;
        }
        
        #endregion
        
        #region Version Info
        
        /// <summary>
        /// è·å–ç‰ˆæœ¬å˜æ›´æ—¥å¿—
        /// </summary>
        public static string GetVersionChangelog()
        {
            return @"
BuffSystem Save Format Changelog:

v1 (Initial):
- åŸºç¡€å­˜æ¡£æ ¼å¼
- æ”¯æŒBuffIdã€å±‚æ•°ã€æŒç»­æ—¶é—´

v2 (Current):
- æ·»åŠ ä¼¤å®³ç±»å‹æšä¸¾æ‰©å±•
- ä¼˜åŒ–CustomDataå­˜å‚¨æ ¼å¼
";
        }
        
        #endregion
    }
}
```

#### éªŒæ”¶æ ‡å‡†

- [x] å­˜æ¡£åŒ…å«ç‰ˆæœ¬å·
- [x] æ”¯æŒè‡ªåŠ¨ç‰ˆæœ¬è¿ç§»
- [x] é«˜ç‰ˆæœ¬å­˜æ¡£æç¤ºé”™è¯¯
- [x] æä¾›è¿ç§»å·¥å…·ç±»
- [x] ç‰ˆæœ¬å˜æ›´æ—¥å¿—æ–‡æ¡£

---

### ğŸ”µ 1.3 æ€§èƒ½ç›‘æ§å™¨åŸºç¡€

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ ä¸­  
**é¢„ä¼°å·¥æ—¶ï¼š** 1-2å¤©  
**å½±å“èŒƒå›´ï¼š** æ–°å¢`Runtime/BuffProfiler.cs`  
**çŠ¶æ€ï¼š** ğŸ”µ ä¿ç•™ï¼ˆv4.0æœªå®Œæˆï¼‰

#### å®ç°æ–¹æ¡ˆ

```csharp
// Runtime/BuffProfiler.cs
using System.Collections.Generic;
using UnityEngine;

namespace BuffSystem.Runtime
{
    /// <summary>
    /// Buffæ€§èƒ½åˆ†æå™¨ - ç›‘æ§è¿è¡Œæ—¶æ€§èƒ½
    /// </summary>
    public class BuffProfiler : MonoBehaviour
    {
        [System.Serializable]
        public class ProfileFrame
        {
            public float Timestamp;
            public float UpdateTime;
            public int BuffCount;
            public int AddCount;
            public int RemoveCount;
            public int EventCount;
        }
        
        private readonly Queue<ProfileFrame> history = new();
        private const int MaxHistory = 300; // 5ç§’ @ 60fps
        
        // å¸§ç»Ÿè®¡
        private int frameAddCount;
        private int frameRemoveCount;
        private int frameEventCount;
        private float frameUpdateTime;
        
        public static BuffProfiler Instance { get; private set; }
        
        // ç»Ÿè®¡å±æ€§
        public int CurrentBuffCount { get; private set; }
        public float AverageUpdateTime { get; private set; }
        public IReadOnlyCollection<ProfileFrame> History => history;
        
        private void Awake()
        {
            Instance = this;
        }
        
        #region Recording
        
        public void RecordAdd()
        {
            frameAddCount++;
        }
        
        public void RecordRemove()
        {
            frameRemoveCount++;
        }
        
        public void RecordEvent()
        {
            frameEventCount++;
        }
        
        public void RecordUpdateTime(float time)
        {
            frameUpdateTime += time;
        }
        
        #endregion
        
        private void LateUpdate()
        {
            // ç»Ÿè®¡å½“å‰Buffæ•°é‡
            CurrentBuffCount = CountAllBuffs();
            
            // è®°å½•å¸§æ•°æ®
            var frame = new ProfileFrame
            {
                Timestamp = Time.time,
                UpdateTime = frameUpdateTime,
                BuffCount = CurrentBuffCount,
                AddCount = frameAddCount,
                RemoveCount = frameRemoveCount,
                EventCount = frameEventCount
            };
            
            history.Enqueue(frame);
            if (history.Count > MaxHistory)
            {
                history.Dequeue();
            }
            
            // è®¡ç®—å¹³å‡å€¼
            CalculateAverages();
            
            // é‡ç½®å¸§ç»Ÿè®¡
            frameAddCount = 0;
            frameRemoveCount = 0;
            frameEventCount = 0;
            frameUpdateTime = 0f;
        }
        
        private int CountAllBuffs()
        {
            int count = 0;
            foreach (var owner in BuffOwner.AllOwners)
            {
                count += owner.BuffContainer?.Count ?? 0;
            }
            return count;
        }
        
        private void CalculateAverages()
        {
            if (history.Count == 0) return;
            
            float totalUpdateTime = 0f;
            foreach (var frame in history)
            {
                totalUpdateTime += frame.UpdateTime;
            }
            
            AverageUpdateTime = totalUpdateTime / history.Count;
        }
        
        #region Analysis
        
        /// <summary>
        /// è·å–æ€§èƒ½æŠ¥å‘Š
        /// </summary>
        public string GetPerformanceReport()
        {
            return $@"
=== BuffSystem Performance Report ===
Current Buff Count: {CurrentBuffCount}
Average Update Time: {AverageUpdateTime:F3}ms
History Frames: {history.Count}

Recommendations:
{GetRecommendations()}
";
        }
        
        private string GetRecommendations()
        {
            var recommendations = new List<string>();
            
            if (AverageUpdateTime > 1.0f)
            {
                recommendations.Add("- Update time is high (>1ms), consider enabling batch update");
            }
            
            if (CurrentBuffCount > 1000)
            {
                recommendations.Add("- Large number of buffs, consider optimizing effect complexity");
            }
            
            return recommendations.Count > 0 
                ? string.Join("\n", recommendations) 
                : "- Performance is optimal";
        }
        
        #endregion
    }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] è®°å½•Buffæ•°é‡å˜åŒ–
- [ ] è®°å½•æ›´æ–°è€—æ—¶
- [ ] æä¾›æ€§èƒ½æŠ¥å‘Š
- [ ] æä¾›ä¼˜åŒ–å»ºè®®

---

## Phase 2: å¼€å‘è€…ä½“éªŒ

### ğŸ”µ 2.1 å®Œæ•´ç¤ºä¾‹é¡¹ç›®

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜  
**é¢„ä¼°å·¥æ—¶ï¼š** 3-5å¤©  
**å½±å“èŒƒå›´ï¼š** æ–°å¢`Examples`æ–‡ä»¶å¤¹  
**çŠ¶æ€ï¼š** ğŸ”µ ä¿ç•™ï¼ˆv4.0æœªå®Œæˆï¼‰

#### ç¤ºä¾‹æ¸…å•

| ç¤ºä¾‹ç¼–å· | åç§° | å†…å®¹ | å­¦ä¹ ç›®æ ‡ |
|---------|------|------|---------|
| 01 | BasicBuff | åŸºç¡€Buffæ·»åŠ /ç§»é™¤ | å¿«é€Ÿä¸Šæ‰‹ |
| 02 | StackableBuff | å¯å åŠ Buffæ¼”ç¤º | å å±‚ç³»ç»Ÿ |
| 03 | DOTEffect | æŒç»­ä¼¤å®³æ•ˆæœ | Effectå¼€å‘ |
| 04 | BuffCondition | æ¡ä»¶ç³»ç»Ÿ | æ¡ä»¶åˆ¤æ–­ |
| 05 | BuffCombo | Buffè¿æº | è¿æºç³»ç»Ÿ |
| 06 | BuffArea | åŒºåŸŸæ•ˆæœ | åŒºåŸŸç³»ç»Ÿ |
| 07 | SaveLoad | å­˜æ¡£åŠ è½½ | æŒä¹…åŒ– |
| 08 | CompleteDemo | å®Œæ•´RPGæ¼”ç¤º | ç»¼åˆåº”ç”¨ |

#### 01-BasicBuffç¤ºä¾‹

```csharp
// Examples/01-BasicBuff/BasicBuffExample.cs
using UnityEngine;
using BuffSystem.Core;
using BuffSystem.Runtime;

namespace BuffSystem.Examples
{
    /// <summary>
    /// åŸºç¡€Buffç¤ºä¾‹ - æ¼”ç¤ºæœ€ç®€å•çš„Buffæ·»åŠ å’Œç§»é™¤
    /// </summary>
    public class BasicBuffExample : MonoBehaviour
    {
        [Header("é…ç½®")]
        [SerializeField] private int buffId = 1001;
        [SerializeField] private KeyCode addKey = KeyCode.Space;
        [SerializeField] private KeyCode removeKey = KeyCode.R;
        
        private BuffOwner buffOwner;
        private IBuff currentBuff;
        
        private void Start()
        {
            // è·å–æˆ–æ·»åŠ BuffOwnerç»„ä»¶
            buffOwner = GetComponent<BuffOwner>();
            if (buffOwner == null)
            {
                buffOwner = gameObject.AddComponent<BuffOwner>();
            }
            
            Debug.Log("[BasicBuffExample] æŒ‰ç©ºæ ¼é”®æ·»åŠ Buffï¼ŒæŒ‰Ré”®ç§»é™¤");
        }
        
        private void Update()
        {
            // æ·»åŠ Buff
            if (Input.GetKeyDown(addKey))
            {
                AddBuff();
            }
            
            // ç§»é™¤Buff
            if (Input.GetKeyDown(removeKey))
            {
                RemoveBuff();
            }
        }
        
        private void AddBuff()
        {
            currentBuff = BuffApi.AddBuff(buffId, buffOwner, this);
            
            if (currentBuff != null)
            {
                Debug.Log($"[BasicBuffExample] æ·»åŠ BuffæˆåŠŸ: {currentBuff.Name}");
            }
            else
            {
                Debug.LogWarning("[BasicBuffExample] æ·»åŠ Buffå¤±è´¥");
            }
        }
        
        private void RemoveBuff()
        {
            if (currentBuff != null)
            {
                buffOwner.BuffContainer.RemoveBuff(currentBuff);
                Debug.Log("[BasicBuffExample] ç§»é™¤Buff");
                currentBuff = null;
            }
        }
        
        private void OnGUI()
        {
            GUILayout.BeginArea(new Rect(10, 10, 300, 150), "Basic Buff Example", "box");
            
            GUILayout.Label($"å½“å‰Buffæ•°é‡: {buffOwner.BuffCount}");
            
            if (currentBuff != null)
            {
                GUILayout.Label($"å½“å‰Buff: {currentBuff.Name}");
                GUILayout.Label($"å±‚æ•°: {currentBuff.CurrentStack}");
                GUILayout.Label($"å‰©ä½™æ—¶é—´: {currentBuff.RemainingTime:F1}s");
            }
            else
            {
                GUILayout.Label("å½“å‰æ— Buff");
            }
            
            GUILayout.EndArea();
        }
    }
}
```

#### 08-CompleteDemoå®Œæ•´æ¼”ç¤º

```csharp
// Examples/08-CompleteDemo/CompleteDemoManager.cs
using UnityEngine;
using BuffSystem.Core;
using BuffSystem.Runtime;

namespace BuffSystem.Examples
{
    /// <summary>
    /// å®Œæ•´æ¼”ç¤º - æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„RPGæˆ˜æ–—åœºæ™¯
    /// </summary>
    public class CompleteDemoManager : MonoBehaviour
    {
        [Header("è§’è‰²")]
        [SerializeField] private DemoCharacter player;
        [SerializeField] private DemoCharacter enemy;
        
        [Header("æŠ€èƒ½")]
        [SerializeField] private int poisonBuffId = 1001;
        [SerializeField] private int shieldBuffId = 1002;
        [SerializeField] private int berserkBuffId = 1003;
        
        private void OnGUI()
        {
            GUILayout.BeginArea(new Rect(Screen.width - 310, 10, 300, 400), "Complete Demo", "box");
            
            GUILayout.Label("=== ç©å®¶æŠ€èƒ½ ===");
            
            if (GUILayout.Button("æ–½æ”¾æ¯’ç´  (DOT)"))
            {
                player.CastBuff(poisonBuffId, enemy);
            }
            
            if (GUILayout.Button("æ–½æ”¾æŠ¤ç›¾"))
            {
                player.CastBuff(shieldBuffId, player);
            }
            
            if (GUILayout.Button("ç‹‚æš´ (æ”»å‡»æå‡)"))
            {
                player.CastBuff(berserkBuffId, player);
            }
            
            GUILayout.Space(20);
            GUILayout.Label("=== æ•ŒäººæŠ€èƒ½ ===");
            
            if (GUILayout.Button("æ•Œäººæ”»å‡»"))
            {
                enemy.Attack(player);
            }
            
            GUILayout.Space(20);
            GUILayout.Label("=== çŠ¶æ€ ===");
            GUILayout.Label($"ç©å®¶ç”Ÿå‘½: {player.Health:F0}/{player.MaxHealth:F0}");
            GUILayout.Label($"æ•Œäººç”Ÿå‘½: {enemy.Health:F0}/{enemy.MaxHealth:F0}");
            
            GUILayout.EndArea();
        }
    }
    
    /// <summary>
    /// æ¼”ç¤ºè§’è‰²
    /// </summary>
    public class DemoCharacter : MonoBehaviour, IAttributeOwner, IDamageable, IHealable
    {
        [SerializeField] private float maxHealth = 100f;
        [SerializeField] private float attack = 10f;
        [SerializeField] private float defense = 5f;
        
        private float currentHealth;
        private BuffOwner buffOwner;
        private readonly Dictionary<string, float> attributes = new();
        
        public float Health => currentHealth;
        public float MaxHealth => maxHealth;
        
        private void Start()
        {
            currentHealth = maxHealth;
            buffOwner = GetComponent<BuffOwner>();
            
            // åˆå§‹åŒ–å±æ€§
            attributes["Attack"] = attack;
            attributes["Defense"] = defense;
        }
        
        public void CastBuff(int buffId, DemoCharacter target)
        {
            BuffApi.AddBuff(buffId, target.buffOwner, this);
        }
        
        public void Attack(DemoCharacter target)
        {
            float damage = GetAttribute("Attack") - target.GetAttribute("Defense");
            damage = Mathf.Max(1f, damage);
            
            target.TakeDamage(new DamageInfo(Mathf.RoundToInt(damage), DamageType.Physical, this, false));
        }
        
        public void TakeDamage(DamageInfo damageInfo)
        {
            currentHealth -= damageInfo.Amount;
            currentHealth = Mathf.Max(0f, currentHealth);
            
            Debug.Log($"{name} å—åˆ° {damageInfo.Amount} ç‚¹ä¼¤å®³");
            
            if (currentHealth <= 0)
            {
                Debug.Log($"{name} è¢«å‡»è´¥!");
            }
        }
        
        public void Heal(int amount, object source)
        {
            currentHealth += amount;
            currentHealth = Mathf.Min(currentHealth, maxHealth);
            
            Debug.Log($"{name} æ¢å¤ {amount} ç‚¹ç”Ÿå‘½");
        }
        
        public float GetAttribute(string name)
        {
            return attributes.TryGetValue(name, out var value) ? value : 0f;
        }
        
        public void AddAttribute(string name, float value)
        {
            if (!attributes.ContainsKey(name))
            {
                attributes[name] = 0f;
            }
            attributes[name] += value;
        }
        
        public void MultiplyAttribute(string name, float multiplier)
        {
            if (attributes.ContainsKey(name))
            {
                attributes[name] *= multiplier;
            }
        }
        
        public void SetAttribute(string name, float value)
        {
            attributes[name] = value;
        }
    }
}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] 8ä¸ªç‹¬ç«‹ç¤ºä¾‹åœºæ™¯
- [ ] æ¯ä¸ªç¤ºä¾‹æœ‰è¯¦ç»†æ³¨é‡Š
- [ ] æä¾›READMEè¯´æ˜
- [ ] ç¤ºä¾‹å¯ç›´æ¥è¿è¡Œ
- [ ] åŒ…å«æ¼”ç¤ºè§†é¢‘/GIF

---

### ğŸ”µ 2.2 å¯è§†åŒ–è°ƒè¯•çª—å£

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ ä¸­  
**é¢„ä¼°å·¥æ—¶ï¼š** 2-3å¤©  
**å½±å“èŒƒå›´ï¼š** æ–°å¢`Editor/BuffDebugger`æ–‡ä»¶å¤¹  
**çŠ¶æ€ï¼š** ğŸ”µ ä¿ç•™ï¼ˆv4.0æœªå®Œæˆï¼‰

#### å®ç°æ–¹æ¡ˆ

```csharp
// Editor/BuffDebugger/BuffSystemDebugger.cs
#if UNITY_EDITOR
using UnityEditor;
using UnityEngine;
using BuffSystem.Core;
using BuffSystem.Runtime;
using System.Collections.Generic;
using System.Linq;

namespace BuffSystem.Editor
{
    /// <summary>
    /// Buffç³»ç»Ÿè°ƒè¯•çª—å£ - è¿è¡Œæ—¶çŠ¶æ€ç›‘æ§
    /// </summary>
    public class BuffSystemDebugger : EditorWindow
    {
        private Vector2 mainScrollPosition;
        private Vector2 detailScrollPosition;
        private IBuffOwner selectedOwner;
        private IBuff selectedBuff;
        
        private bool autoRefresh = true;
        private float refreshInterval = 0.5f;
        private double lastRefreshTime;
        
        private GUIStyle headerStyle;
        private GUIStyle boxStyle;
        private bool stylesInitialized;
        
        [MenuItem("Window/BuffSystem/Debugger #F12")]
        public static void ShowWindow()
        {
            var window = GetWindow<BuffSystemDebugger>("Buff Debugger");
            window.minSize = new Vector2(600, 400);
        }
        
        private void InitStyles()
        {
            if (stylesInitialized) return;
            
            headerStyle = new GUIStyle(EditorStyles.boldLabel)
            {
                fontSize = 14,
                margin = new RectOffset(0, 0, 10, 5)
            };
            
            boxStyle = new GUIStyle(GUI.skin.box)
            {
                padding = new RectOffset(10, 10, 10, 10)
            };
            
            stylesInitialized = true;
        }
        
        private void OnGUI()
        {
            InitStyles();
            
            // è‡ªåŠ¨åˆ·æ–°
            if (autoRefresh && EditorApplication.timeSinceStartup - lastRefreshTime > refreshInterval)
            {
                Repaint();
                lastRefreshTime = EditorApplication.timeSinceStartup;
            }
            
            DrawToolbar();
            
            EditorGUILayout.BeginHorizontal();
            
            // å·¦ä¾§ï¼šæŒæœ‰è€…åˆ—è¡¨
            EditorGUILayout.BeginVertical(GUILayout.Width(250));
            DrawOwnerList();
            EditorGUILayout.EndVertical();
            
            EditorGUILayout.BeginVertical(GUILayout.Width(1));
            GUILayout.Box("", GUILayout.Width(1), GUILayout.ExpandHeight(true));
            EditorGUILayout.EndVertical();
            
            // å³ä¾§ï¼šè¯¦æƒ…é¢æ¿
            EditorGUILayout.BeginVertical();
            if (selectedOwner != null)
            {
                DrawOwnerDetails(selectedOwner);
            }
            else
            {
                EditorGUILayout.LabelField("é€‰æ‹©ä¸€ä¸ªæŒæœ‰è€…æŸ¥çœ‹è¯¦æƒ…", EditorStyles.centeredGreyMiniLabel);
            }
            EditorGUILayout.EndVertical();
            
            EditorGUILayout.EndHorizontal();
        }
        
        private void DrawToolbar()
        {
            EditorGUILayout.BeginHorizontal(EditorStyles.toolbar);
            
            autoRefresh = GUILayout.Toggle(autoRefresh, "Auto Refresh", EditorStyles.toolbarButton, GUILayout.Width(100));
            
            if (GUILayout.Button("Refresh", EditorStyles.toolbarButton, GUILayout.Width(80)))
            {
                Repaint();
            }
            
            GUILayout.FlexibleSpace();
            
            if (GUILayout.Button("Clear All", EditorStyles.toolbarButton, GUILayout.Width(80)))
            {
                if (EditorUtility.DisplayDialog("ç¡®è®¤", "æ¸…é™¤æ‰€æœ‰Buff?", "æ˜¯", "å¦"))
                {
                    ClearAllBuffs();
                }
            }
            
            EditorGUILayout.EndHorizontal();
        }
        
        private void DrawOwnerList()
        {
            EditorGUILayout.LabelField("Buff Holders", headerStyle);
            
            mainScrollPosition = EditorGUILayout.BeginScrollView(mainScrollPosition);
            
            var owners = BuffOwner.AllOwners;
            if (owners.Count == 0)
            {
                EditorGUILayout.HelpBox("No BuffOwner found in scene", MessageType.Info);
            }
            else
            {
                foreach (var owner in owners)
                {
                    DrawOwnerItem(owner);
                }
            }
            
            EditorGUILayout.EndScrollView();
            
            // å…¨å±€ç»Ÿè®¡
            EditorGUILayout.Space();
            EditorGUILayout.LabelField("Global Stats", headerStyle);
            
            int totalBuffs = owners.Sum(o => o.BuffContainer?.Count ?? 0);
            EditorGUILayout.LabelField($"Total Owners: {owners.Count}");
            EditorGUILayout.LabelField($"Total Buffs: {totalBuffs}");
        }
        
        private void DrawOwnerItem(IBuffOwner owner)
        {
            bool isSelected = selectedOwner == owner;
            int buffCount = owner.BuffContainer?.Count ?? 0;
            
            EditorGUILayout.BeginHorizontal(isSelected ? "SelectionRect" : GUIStyle.none);
            
            if (GUILayout.Toggle(isSelected, $"{owner.OwnerName} ({buffCount})", EditorStyles.radioButton))
            {
                selectedOwner = owner;
                selectedBuff = null;
            }
            
            EditorGUILayout.EndHorizontal();
        }
        
        private void DrawOwnerDetails(IBuffOwner owner)
        {
            detailScrollPosition = EditorGUILayout.BeginScrollView(detailScrollPosition);
            
            EditorGUILayout.LabelField($"{owner.OwnerName}", headerStyle);
            
            // å¿«é€Ÿæ“ä½œ
            EditorGUILayout.BeginVertical(boxStyle);
            EditorGUILayout.LabelField("Quick Actions", EditorStyles.boldLabel);
            
            EditorGUILayout.BeginHorizontal();
            if (GUILayout.Button("Clear All Buffs"))
            {
                owner.BuffContainer?.ClearAllBuffs();
            }
            EditorGUILayout.EndHorizontal();
            
            EditorGUILayout.EndVertical();
            
            EditorGUILayout.Space();
            
            // Buffåˆ—è¡¨
            EditorGUILayout.LabelField("Active Buffs", headerStyle);
            
            if (owner.BuffContainer?.Count == 0)
            {
                EditorGUILayout.HelpBox("No active buffs", MessageType.Info);
            }
            else
            {
                foreach (var buff in owner.BuffContainer.AllBuffs)
                {
                    DrawBuffItem(buff);
                }
            }
            
            EditorGUILayout.EndScrollView();
        }
        
        private void DrawBuffItem(IBuff buff)
        {
            bool isSelected = selectedBuff == buff;
            
            EditorGUILayout.BeginVertical(isSelected ? "SelectionRect" : boxStyle);
            
            EditorGUILayout.BeginHorizontal();
            EditorGUILayout.LabelField($"{buff.Name} (ID: {buff.DataId})", EditorStyles.boldLabel);
            
            if (GUILayout.Button("Remove", GUILayout.Width(60)))
            {
                buff.Owner.BuffContainer.RemoveBuff(buff);
            }
            
            EditorGUILayout.EndHorizontal();
            
            EditorGUILayout.LabelField($"Stack: {buff.CurrentStack}/{buff.MaxStack}");
            EditorGUILayout.LabelField($"Time: {(buff.IsPermanent ? "Permanent" : $"{buff.RemainingTime:F1}s")}");
            
            // å±‚æ•°æ“ä½œ
            EditorGUILayout.BeginHorizontal();
            if (GUILayout.Button("+1 Stack", GUILayout.Width(80)))
            {
                buff.AddStack(1);
            }
            if (GUILayout.Button("-1 Stack", GUILayout.Width(80)))
            {
                buff.RemoveStack(1);
            }
            EditorGUILayout.EndHorizontal();
            
            EditorGUILayout.EndVertical();
            EditorGUILayout.Space(5);
        }
        
        private void ClearAllBuffs()
        {
            foreach (var owner in BuffOwner.AllOwners)
            {
                owner.BuffContainer?.ClearAllBuffs();
            }
        }
    }
}
#endif
```

#### éªŒæ”¶æ ‡å‡†

- [ ] æ˜¾ç¤ºæ‰€æœ‰BuffOwneråˆ—è¡¨
- [ ] æ˜¾ç¤ºæ¯ä¸ªOwnerçš„Buffè¯¦æƒ…
- [ ] æ”¯æŒæ‰‹åŠ¨æ·»åŠ /ç§»é™¤Buff
- [ ] æ”¯æŒä¿®æ”¹å±‚æ•°
- [ ] è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
- [ ] å¿«æ·é”®æ”¯æŒ (Ctrl+Shift+B)

---

### ğŸ”µ 2.3 æ–‡æ¡£å®Œå–„

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜  
**é¢„ä¼°å·¥æ—¶ï¼š** 3-5å¤©  
**å½±å“èŒƒå›´ï¼š** `Documentation`æ–‡ä»¶å¤¹  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆï¼ˆåŸºç¡€æ–‡æ¡£å·²å®Œå–„ï¼‰

#### æ–‡æ¡£æ¸…å•

| æ–‡æ¡£ | ä¼˜å…ˆçº§ | å†…å®¹æ¦‚è¦ |
|------|--------|---------|
| QuickStart.md | ğŸ”´ é«˜ | 15åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ |
| Architecture.md | ğŸŸ¡ ä¸­ | æ¶æ„è®¾è®¡è¯¦è§£ |
| API-Reference.md | ğŸ”´ é«˜ | å®Œæ•´APIå‚è€ƒ |
| Effect-Guide.md | ğŸ”´ é«˜ | Effectå¼€å‘æŒ‡å— |
| Condition-Guide.md | ğŸŸ¡ ä¸­ | æ¡ä»¶ç³»ç»ŸæŒ‡å— |
| Save-Load-Guide.md | ğŸŸ¡ ä¸­ | å­˜æ¡£ç³»ç»ŸæŒ‡å— |
| Performance-Tips.md | ğŸŸ¡ ä¸­ | æ€§èƒ½ä¼˜åŒ–å»ºè®® |
| Networking-Guide.md | ğŸŸ¢ ä½ | ç½‘ç»œåŒæ­¥æŒ‡å— |
| FAQ.md | ğŸŸ¡ ä¸­ | å¸¸è§é—®é¢˜ |
| CHANGELOG.md | ğŸŸ¡ ä¸­ | ç‰ˆæœ¬å˜æ›´æ—¥å¿— |

#### QuickStart.md ç¤ºä¾‹

```markdown
# BuffSystem å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

## 15åˆ†é’Ÿå¿«é€Ÿå…¥é—¨

### ç¬¬1åˆ†é’Ÿï¼šå¯¼å…¥æ’ä»¶
1. å°†BuffSystemæ–‡ä»¶å¤¹å¤åˆ¶åˆ°Assetsç›®å½•
2. ç­‰å¾…Unityç¼–è¯‘å®Œæˆ

### ç¬¬2-5åˆ†é’Ÿï¼šåˆ›å»ºç¬¬ä¸€ä¸ªBuff
1. åœ¨Projectçª—å£å³é”® â†’ Create â†’ BuffSystem â†’ Buff Data
2. å‘½åä¸º"PowerUp"
3. åœ¨Inspectorä¸­é…ç½®ï¼š
   - ID: 1001
   - Name: "Power Up"
   - Duration: 10
   - Max Stack: 3

### ç¬¬6-10åˆ†é’Ÿï¼šæ·»åŠ Effect
1. åœ¨Buff Dataçš„Inspectorä¸­
2. æ‰¾åˆ°"Buff Logic Instance"
3. é€‰æ‹©"EffectBasedBuffLogic"
4. åœ¨"On Acquire Effects"ä¸­æ·»åŠ "ModifyAttributeEffect"
5. é…ç½®å±æ€§å"Attack"ï¼Œä¿®æ”¹å€¼"10"

### ç¬¬11-15åˆ†é’Ÿï¼šæµ‹è¯•è¿è¡Œ
1. åˆ›å»ºCubeï¼Œæ·»åŠ BuffOwnerç»„ä»¶
2. åˆ›å»ºè„šæœ¬ï¼š

```csharp
public class TestBuff : MonoBehaviour
{
    void Update()
    {
        if (Input.GetKeyDown(KeyCode.Space))
        {
            var owner = GetComponent<BuffOwner>();
            BuffApi.AddBuff(1001, owner);
        }
    }
}
```

3. è¿è¡Œæ¸¸æˆï¼ŒæŒ‰ç©ºæ ¼é”®æµ‹è¯•

## ä¸‹ä¸€æ­¥

- é˜…è¯» [Effect-Guide.md](./Effect-Guide.md) å­¦ä¹ è‡ªå®šä¹‰Effect
- æŸ¥çœ‹ [Examples](../Examples/) ä¸­çš„å®Œæ•´ç¤ºä¾‹
```

#### éªŒæ”¶æ ‡å‡†

- [ ] 10ç¯‡æ–‡æ¡£å®Œæˆ
- [ ] æ¯ç¯‡æ–‡æ¡£åŒ…å«ä»£ç ç¤ºä¾‹
- [ ] ä¸­æ–‡/è‹±æ–‡åŒè¯­
- [ ] åŒ…å«ç›®å½•å’Œæœç´¢åŠŸèƒ½

---

## Phase 3: é«˜çº§ç‰¹æ€§

### ğŸ”µ 3.1 ç½‘ç»œåŒæ­¥æ”¯æŒ

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¢ ä½  
**é¢„ä¼°å·¥æ—¶ï¼š** 5-7å¤©  
**å½±å“èŒƒå›´ï¼š** æ–°å¢`Networking`æ–‡ä»¶å¤¹  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆï¼ˆv5.0å·²å®ç°ï¼‰

#### è®¾è®¡ç›®æ ‡

æ”¯æŒMirrorå’ŒNetcode for GameObjectsæ¡†æ¶ï¼Œå®ç°BuffçŠ¶æ€çš„å¤šäººåŒæ­¥ã€‚

#### å®ç°æ–¹æ¡ˆï¼ˆMirrorï¼‰

```csharp
// Networking/Mirror/BuffMirrorSync.cs
#if MIRROR
using Mirror;
using BuffSystem.Core;
using BuffSystem.Runtime;
using System.Collections.Generic;

namespace BuffSystem.Networking.Mirror
{
    /// <summary>
    /// Mirrorç½‘ç»œåŒæ­¥ç»„ä»¶
    /// </summary>
    [RequireComponent(typeof(BuffOwner))]
    public class BuffMirrorSync : NetworkBehaviour
    {
        private BuffOwner buffOwner;
        
        // åŒæ­¥åˆ—è¡¨
        private readonly SyncList<BuffSyncData> syncedBuffs = new();
        
        // æœ¬åœ°Buffç¼“å­˜ï¼ˆç”¨äºå¯¹æ¯”å˜æ›´ï¼‰
        private readonly Dictionary<int, BuffSyncData> localBuffCache = new();
        
        private void Awake()
        {
            buffOwner = GetComponent<BuffOwner>();
        }
        
        public override void OnStartServer()
        {
            base.OnStartServer();
            
            // è®¢é˜…Buffäº‹ä»¶
            if (buffOwner != null)
            {
                buffOwner.LocalEvents.OnBuffAdded += OnServerBuffAdded;
                buffOwner.LocalEvents.OnBuffRemoved += OnServerBuffRemoved;
                buffOwner.LocalEvents.OnBuffStackChanged += OnServerBuffStackChanged;
            }
        }
        
        public override void OnStopServer()
        {
            base.OnStopServer();
            
            if (buffOwner != null)
            {
                buffOwner.LocalEvents.OnBuffAdded -= OnServerBuffAdded;
                buffOwner.LocalEvents.OnBuffRemoved -= OnServerBuffRemoved;
                buffOwner.LocalEvents.OnBuffStackChanged -= OnServerBuffStackChanged;
            }
        }
        
        #region Server Side
        
        [Server]
        private void OnServerBuffAdded(IBuff buff)
        {
            var syncData = new BuffSyncData(buff);
            syncedBuffs.Add(syncData);
        }
        
        [Server]
        private void OnServerBuffRemoved(IBuff buff)
        {
            for (int i = 0; i < syncedBuffs.Count; i++)
            {
                if (syncedBuffs[i].InstanceId == buff.InstanceId)
                {
                    syncedBuffs.RemoveAt(i);
                    break;
                }
            }
        }
        
        [Server]
        private void OnServerBuffStackChanged(IBuff buff, int oldStack, int newStack)
        {
            for (int i = 0; i < syncedBuffs.Count; i++)
            {
                if (syncedBuffs[i].InstanceId == buff.InstanceId)
                {
                    var updated = syncedBuffs[i];
                    updated.Stack = (byte)newStack;
                    syncedBuffs[i] = updated;
                    break;
                }
            }
        }
        
        #endregion
        
        #region Client Side
        
        public override void OnStartClient()
        {
            base.OnStartClient();
            
            syncedBuffs.Callback += OnSyncedBuffsChanged;
            
            // åˆå§‹åŒæ­¥
            if (!isServer)
            {
                foreach (var syncData in syncedBuffs)
                {
                    ApplySyncData(syncData);
                }
            }
        }
        
        private void OnSyncedBuffsChanged(SyncList<BuffSyncData>.Operation op, int index, BuffSyncData item)
        {
            if (isServer) return; // æœåŠ¡å™¨å·²å¤„ç†
            
            switch (op)
            {
                case SyncList<BuffSyncData>.Operation.OP_ADD:
                    ApplySyncData(item);
                    break;
                case SyncList<BuffSyncData>.Operation.OP_REMOVE:
                    RemoveBuffByInstanceId(item.InstanceId);
                    break;
                case SyncList<BuffSyncData>.Operation.OP_SET:
                    UpdateBuffStack(item);
                    break;
            }
        }
        
        private void ApplySyncData(BuffSyncData syncData)
        {
            var data = BuffDatabase.Instance.GetBuffData(syncData.BuffId);
            if (data == null) return;
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (localBuffCache.ContainsKey(syncData.InstanceId))
            {
                UpdateBuffStack(syncData);
                return;
            }
            
            // æ·»åŠ Buff
            var buff = buffOwner.BuffContainer.AddBuff(data, null);
            if (buff is BuffEntity entity)
            {
                // æ¢å¤å±‚æ•°
                if (syncData.Stack > 1)
                {
                    entity.AddStack(syncData.Stack - 1);
                }
                
                // æ¢å¤æŒç»­æ—¶é—´
                entity.SetDuration(syncData.Duration);
                
                // ç¼“å­˜
                localBuffCache[syncData.InstanceId] = syncData;
            }
        }
        
        private void RemoveBuffByInstanceId(int instanceId)
        {
            foreach (var buff in buffOwner.BuffContainer.AllBuffs)
            {
                if (buff.InstanceId == instanceId)
                {
                    buffOwner.BuffContainer.RemoveBuff(buff);
                    localBuffCache.Remove(instanceId);
                    break;
                }
            }
        }
        
        private void UpdateBuffStack(BuffSyncData syncData)
        {
            foreach (var buff in buffOwner.BuffContainer.AllBuffs)
            {
                if (buff.InstanceId == syncData.InstanceId)
                {
                    int diff = syncData.Stack - buff.CurrentStack;
                    if (diff > 0)
                    {
                        buff.AddStack(diff);
                    }
                    else if (diff < 0)
                    {
                        buff.RemoveStack(-diff);
                    }
                    
                    localBuffCache[syncData.InstanceId] = syncData;
                    break;
                }
            }
        }
        
        #endregion
    }
    
    /// <summary>
    /// BuffåŒæ­¥æ•°æ®ç»“æ„ï¼ˆä¼˜åŒ–å¤§å°ï¼‰
    /// </summary>
    public struct BuffSyncData
    {
        public int InstanceId;
        public ushort BuffId;
        public byte Stack;
        public ushort Duration; // å‹ç¼©ä¸º0.1ç§’ç²¾åº¦ï¼Œæœ€å¤§6553ç§’
        
        public BuffSyncData(IBuff buff)
        {
            InstanceId = buff.InstanceId;
            BuffId = (ushort)buff.DataId;
            Stack = (byte)buff.CurrentStack;
            Duration = (ushort)(buff.Duration * 10);
        }
    }
}
#endif
```

#### éªŒæ”¶æ ‡å‡†

- [ ] æ”¯æŒMirroræ¡†æ¶
- [ ] æ”¯æŒNetcode for GameObjectsæ¡†æ¶
- [ ] æœåŠ¡å™¨æƒå¨æ¨¡å¼
- [ ] å¢é‡åŒæ­¥ä¼˜åŒ–
- [ ] æä¾›é›†æˆç¤ºä¾‹

---

## ä¼˜åŒ–å®æ–½æ£€æŸ¥æ¸…å•

### Phase 1 æ£€æŸ¥æ¸…å• - æ ¸å¿ƒåŠŸèƒ½å®Œå–„

- [x] **1.1 å†…ç½®Effectåº“ - é›¶è€¦åˆè®¾è®¡**
  - [x] 1.1.1 SpawnEffectï¼ˆç”Ÿæˆé¢„åˆ¶ä½“ï¼‰
  - [x] 1.1.2 PlayAnimationEffectï¼ˆæ’­æ”¾åŠ¨ç”»ï¼‰
  - [x] 1.1.3 PlaySoundEffectï¼ˆæ’­æ”¾éŸ³æ•ˆï¼‰
  - [x] 1.1.4 TriggerEventEffectï¼ˆè§¦å‘äº‹ä»¶ - æ ¸å¿ƒè§£è€¦ï¼‰
  - [x] 1.1.5 DelayEffectï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰
  - [x] 1.1.6 BuffEventSystemï¼ˆäº‹ä»¶ç³»ç»Ÿï¼‰
  - [ ] 1.1.7 Effect-Development-Guide.mdï¼ˆå¼€å‘æŒ‡å—ï¼‰
  - [ ] 1.1.8 Common-Patterns.mdï¼ˆå¸¸è§æ¨¡å¼ï¼‰
  - [ ] 1.1.9 Best-Practices.mdï¼ˆæœ€ä½³å®è·µï¼‰

- [x] **1.2 å­˜æ¡£ç‰ˆæœ¬ç®¡ç†**
  - [x] 1.2.1 ç‰ˆæœ¬å·æœºåˆ¶
  - [x] 1.2.2 è¿ç§»å·¥å…·
  - [x] 1.2.3 å…¼å®¹æ€§æµ‹è¯•

- [ ] **1.3 æ€§èƒ½ç›‘æ§å™¨**
  - [ ] 1.3.1 åŸºç¡€ç›‘æ§
  - [ ] 1.3.2 æ€§èƒ½æŠ¥å‘Š

### Phase 2 æ£€æŸ¥æ¸…å• - å¼€å‘è€…ä½“éªŒ

- [ ] **2.1 å®Œæ•´ç¤ºä¾‹é¡¹ç›®**
  - [ ] 2.1.1 01-BasicBuff
  - [ ] 2.1.2 02-StackableBuff
  - [ ] 2.1.3 03-DOTEffect
  - [ ] 2.1.4 04-BuffCondition
  - [ ] 2.1.5 05-BuffCombo
  - [ ] 2.1.6 06-BuffArea
  - [ ] 2.1.7 07-SaveLoad
  - [ ] 2.1.8 08-CompleteDemo

- [ ] **2.2 å¯è§†åŒ–è°ƒè¯•çª—å£**
  - [ ] 2.2.1 æŒæœ‰è€…åˆ—è¡¨
  - [ ] 2.2.2 Buffè¯¦æƒ…
  - [ ] 2.2.3 æ‰‹åŠ¨æ“ä½œ
  - [ ] 2.2.4 è‡ªåŠ¨åˆ·æ–°

- [x] **2.3 æ–‡æ¡£å®Œå–„**
  - [x] 2.3.1 README.md (QuickStart)
  - [x] 2.3.2 API.md (API-Reference)
  - [x] 2.3.3 Tutorial.md (Effect-Guide)
  - [ ] 2.3.4 Condition-Guide.md
  - [x] 2.3.5 CHANGELOG.md
  - [ ] 2.3.6 Performance-Tips.md
  - [ ] 2.3.7 FAQ.md
  - [ ] 2.3.8 CHANGELOG.md

### Phase 3 æ£€æŸ¥æ¸…å• - é«˜çº§ç‰¹æ€§

- [x] **3.1 ç½‘ç»œåŒæ­¥æ”¯æŒ**
  - [x] 3.1.1 Mirroræ¡†æ¶æ”¯æŒ
  - [x] 3.1.2 Netcodeæ¡†æ¶æ”¯æŒ
  - [x] 3.1.3 åŒæ­¥ä¼˜åŒ–
  - [ ] 3.1.4 ç¤ºä¾‹é¡¹ç›®

---

## ç‰ˆæœ¬å‘å¸ƒè®¡åˆ’

### v5.0.0 - æ ¸å¿ƒåŠŸèƒ½ç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** Phase 1å®Œæˆå  
**ä¸»è¦å†…å®¹ï¼š**
- 5ä¸ªé›¶è€¦åˆCore Effectï¼ˆ100%é€šç”¨ï¼‰
- äº‹ä»¶ç³»ç»Ÿï¼ˆBuffEventSystemï¼‰
- 3ç¯‡Effectå¼€å‘æ–‡æ¡£
- å­˜æ¡£ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ
- åŸºç¡€æ€§èƒ½ç›‘æ§å™¨

**ç›®æ ‡ç”¨æˆ·ï¼š** æ‰€æœ‰Unityå¼€å‘è€…ï¼ˆçœŸæ­£é€šç”¨ï¼‰

### v5.1.0 - å¼€å‘è€…ä½“éªŒç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** Phase 2å®Œæˆå  
**ä¸»è¦å†…å®¹ï¼š**
- 8ä¸ªå®Œæ•´ç¤ºä¾‹é¡¹ç›®
- å¯è§†åŒ–è°ƒè¯•çª—å£
- å®Œå–„çš„æ–‡æ¡£ç³»ç»Ÿ

**ç›®æ ‡ç”¨æˆ·ï¼š** æ–°æ‰‹å¼€å‘è€…ï¼Œéœ€è¦å­¦ä¹ èµ„æº

### v5.2.0 - é«˜çº§ç‰¹æ€§ç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** Phase 3å®Œæˆå  
**ä¸»è¦å†…å®¹ï¼š**
- ç½‘ç»œåŒæ­¥æ”¯æŒï¼ˆMirror/Netcodeï¼‰
- å¤šäººæ¸¸æˆç¤ºä¾‹
- æœ€ç»ˆä¼˜åŒ–ä¸æµ‹è¯•

**ç›®æ ‡ç”¨æˆ·ï¼š** å¤šäººæ¸¸æˆå¼€å‘è€…

### v5.3.0 - æ­£å¼ç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** å…¨éƒ¨ä¼˜åŒ–å®Œæˆå  
**ä¸»è¦å†…å®¹ï¼š**
- 100%ç”Ÿäº§å°±ç»ª
- å®Œæ•´æµ‹è¯•è¦†ç›–
- å•†ä¸šçº§æ–‡æ¡£

**ç›®æ ‡ç”¨æˆ·ï¼š** æ‰€æœ‰Unityå¼€å‘è€…

---

## é™„å½•

### A. ä¼˜å…ˆçº§è¯´æ˜

| ä¼˜å…ˆçº§ | æ ‡è¯† | è¯´æ˜ |
|--------|------|------|
| é«˜ | ğŸ”´ | æ ¸å¿ƒåŠŸèƒ½ï¼Œå»ºè®®ä¼˜å…ˆå®Œæˆ |
| ä¸­ | ğŸŸ¡ | é‡è¦åŠŸèƒ½ï¼Œå»ºè®®æŒ‰è®¡åˆ’å®Œæˆ |
| ä½ | ğŸŸ¢ | å¯é€‰åŠŸèƒ½ï¼Œæ ¹æ®éœ€æ±‚å®Œæˆ |

### B. çŠ¶æ€æ ‡è¯†

| çŠ¶æ€ | æ ‡è¯† | è¯´æ˜ |
|------|------|------|
| å·²å®Œæˆ | âœ… | å·²å¼€å‘å¹¶æµ‹è¯•å®Œæˆ |
| å¾…å®Œæˆ | â¬œ | å¾…å¼€å‘ |
| ä¿ç•™ | ğŸ”µ | ç»§æ‰¿è‡ªv4.0çš„ä¼˜åŒ–é¡¹ |

### C. å·¥æ—¶ä¼°ç®—

| Phase | é¢„ä¼°å·¥æ—¶ | å®é™…å·¥æ—¶ | å¤‡æ³¨ |
|-------|---------|---------|------|
| Phase 1 | 6-10å¤© | - | æ ¸å¿ƒåŠŸèƒ½ |
| Phase 2 | 6-10å¤© | - | å¼€å‘è€…ä½“éªŒ |
| Phase 3 | 5-7å¤© | - | é«˜çº§ç‰¹æ€§ |
| **æ€»è®¡** | **17-27å¤©** | - | çº¦3-5å‘¨ |

---

*æ–‡æ¡£ç»“æŸ*
